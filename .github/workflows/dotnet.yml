# This workflow will build a .NET project, run it to produce a `dist` folder,
# and publish the `dist` folder to GitHub Pages.
# For more information see:
# - Actions for Pages: https://docs.github.com/en/actions/deployment/targeting-different-environments/about-environments
# - Upload & deploy pages actions: https://github.com/actions/configure-pages, https://github.com/actions/upload-pages-artifact, https://github.com/actions/deploy-pages

name: .NET

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]
  workflow_dispatch:
    inputs:
      deploy:
        description: 'Set to "true" to upload and deploy to GitHub Pages when running manually'
        required: false
        default: 'false'

permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: 10.0.x

    - name: Restore dependencies
      run: dotnet restore

    - name: Build
      run: dotnet build --no-restore --configuration Release

    - name: Test
      run: dotnet test --no-build --verbosity normal --configuration Release

    - name: Run app to produce dist
      # Adjust this command if your app/project needs a path or special args.
      # If your app produces a platform-specific Windows-only .exe, switch to windows-latest and call the .exe instead.
      run: dotnet run --no-build --configuration Release --project generator/src/MarkdownBlog.Generator --out dist

    - name: Show dist contents
      run: |
        echo "=== dist contents ==="
        ls -la dist || true

    - name: Upload artifact for GitHub Pages
      if: github.event_name == 'push' || github.event.inputs.deploy == 'true'
      uses: actions/upload-pages-artifact@v4
      with:
        path: dist

    - name: Deploy to GitHub Pages
      if: github.event_name == 'push' || github.event.inputs.deploy == 'true'
      uses: actions/deploy-pages@v4
